# 一键部署 - PaaS

> **\[info\] 输入/输出**
>
> 输入：一键部署模板\(midware.xlsx\)
>
> 输出：每步动作安装状态和结果

## PAAS层部署步骤细分如下：

* ### ZCM的安装与启动

  * 安装基础工具，如：docker等第三方软件
  * 安装Harbor镜像仓库
  * 导入ZCM所需的基础服务镜像并启动
  * 部署并启动Portal页面系统
  * 安装Kubernetes自动化容器操作开源平台

* ### 创建项目

  * 逻辑资源隔离\(应用+机器+集群+zone\)
  * 通过读取模板文件`midware.xls`中的`project`页签中的配置创建**项目**
* ### 创建Zone

  * 无状态应用部署的机器隔离
  * 通过读取模板文件`midware.xls`中的`zone`页签中的配置创建**zone**
* ### 创建云盘信息

  * 跨主机访问数据
  * 通过读取模板文件`midware.xls`中的`cloud disk`页签中的配置，创建需要的云盘和对应的云盘大小
* ### 创建业务网关

  * 用于转发业务访问端口
  * 通过读取模板文件`midware.xls`中的`gateway cluster`页签中的配置进行创建网关
  * **machine\_ip\_list**和**vip**字段填入的数值是zcm的k8s的node节点的物理IP
  
* ### 创建基础集群

  * 用于给有状态应用使用的集群
  * 通过读取模板文件`midware.xlsx`中的`base cluster`工作表中的配置进行创建基础集群
  * **cluster_name**和**machine_ip_list**字段填入的数值是定义的集群名称和IP
  
* ### 获取业务镜像信息

  * 读取app.json文件中的镜像信息
* ### 上传业务镜像

  * 从种子机的镜像仓库中将业务镜像导入到镜像仓库
* ### 同步镜像

  * 将上一步导入的镜像同步到ZCM的镜像管理
* ### 检测项目镜像

  * 检查导入到镜像仓库的镜像是否遗漏
  * 检查导入的镜像是否可以被访问
* ### 安装启动ZOOKEEPER

  * 安装并启动ZOOKEEPER
  * 构建集群
* ### 安装启动ZMQ

  * 安装并启动ZMQ
  * 构建集群
  * 创建Topic
* ### 安装启动ZCACHE

  * 安装并启动ZCACHE
  * 构建集群



